<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>Cleaning up | BioInfoSummer: Image Analysis with Fiji/ImageJ</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.0.3">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    <link rel="next" href="../automate/automate3.html" />
    
    
    <link rel="prev" href="../automate/automate.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book"  data-level="2.2" data-basepath=".." data-revision="1416797934712">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="imagej/intro.html">
            
                
                    <a href="../imagej/intro.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         ImageJ/Fiji
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="imagej/demo1.html">
            
                
                    <a href="../imagej/demo1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         Fluorescent stain measurement
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="imagej/demo2.html">
            
                
                    <a href="../imagej/demo2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         Cell counting and measurements
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.3" data-path="imagej/demo3.html">
            
                
                    <a href="../imagej/demo3.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                         Cell scoring
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="automate/getting_started.html">
            
                
                    <a href="../automate/getting_started.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Automation of image analysis
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="automate/automate.html">
            
                
                    <a href="../automate/automate.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         Automated cell scoring
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="2.2" data-path="automate/automate2.html">
            
                
                    <a href="../automate/automate2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         Cleaning up
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.3" data-path="automate/automate3.html">
            
                
                    <a href="../automate/automate3.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                         Refinements
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.4" data-path="automate/results.html">
            
                
                    <a href="../automate/results.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                         Pretty Results
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="scaling/scaling.html">
            
                
                    <a href="../scaling/scaling.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Scaling up
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" data-path="scaling/files.html">
            
                
                    <a href="../scaling/files.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                         Working with files
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >BioInfoSummer: Image Analysis with Fiji/ImageJ</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_6">
                    
                        <h1 id="cleaning-up-the-code">Cleaning up the code</h1>
<p>We can introduce functions to encapsulate certain tasks and break the code up into logical blocks.</p>
<hr>
<p>Create a function to splits channels and return them separate images.</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">split_channels</span><span class="hljs-params">(image)</span>:</span>
    <span class="hljs-string">"""Split a 3-channel image and returns the 3 separate channels.
    :param image input image
    :type image ImagePlus
    :return tuple containing 3 individual channels
    """</span>
    channels = ChannelSplitter.split(image)
    <span class="hljs-keyword">return</span> channels[<span class="hljs-number">0</span>], channels[<span class="hljs-number">1</span>], channels[<span class="hljs-number">2</span>]

img = IJ.getImage()
ki67, ph3, dapi = split_channels(img)
<span class="hljs-comment">#... rest of code</span>
</code></pre>
<hr>
<p>Next, we can create functions for segmentating different channels. The same segmentation procedure is used for both Ki67 and Ph3, so one function will work for both. DAPI needs an extra watershed steps to split touching cells, so it gets a separate function.</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">segment_marker</span><span class="hljs-params">(img)</span>:</span>
    <span class="hljs-string">"""Segment marker channel by Li autothreshold and output binary.
    :param img input image
    :type img ImagePlus
    :return segmented binary image
    """</span>
    img.getProcessor().setAutoThreshold(AutoThresholder.Method.Li, <span class="hljs-keyword">True</span>)
    IJ.run(img, <span class="hljs-string">"Convert to Mask"</span>, <span class="hljs-string">""</span>)
    <span class="hljs-keyword">return</span> img


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">segment_dapi</span><span class="hljs-params">(img)</span>:</span>
    <span class="hljs-string">"""Segment DAPI channel by Li autothreshold, perform watershed to split
    cells and output binary.
    :param img input image
    :type img ImagePlus
    :return segmented binary image
    """</span>
    img.getProcessor().setAutoThreshold(AutoThresholder.Method.Li, <span class="hljs-keyword">True</span>)
    IJ.run(img, <span class="hljs-string">"Convert to Mask"</span>, <span class="hljs-string">""</span>)
    IJ.run(img, <span class="hljs-string">"Watershed"</span>, <span class="hljs-string">""</span>)
    <span class="hljs-keyword">return</span> img
</code></pre>
<p>These are simply applied as such:</p>
<pre><code class="lang-python"><span class="hljs-comment"># Segment DAPI image and split cells using watershed</span>
dapi = segment_dapi(dapi)

<span class="hljs-comment"># Segment Ki67 image</span>
ki67 = segment_marker(ki67)

<span class="hljs-comment"># Segment Ph3 image</span>
ph3 = segment_marker(ph3)
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../automate/automate.html" class="navigation navigation-prev " aria-label="Previous page: Automated cell scoring"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../automate/automate3.html" class="navigation navigation-next " aria-label="Next page: Refinements"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
